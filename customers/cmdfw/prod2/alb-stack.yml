stackName: ${CDK_PFIX}-${CDK_ENV}-alb-stack
region: ${CDK_REGION}
accountId: ${CDK_ENV}.accountid
tags:
    cost.center: ${CDK_ENV}
    dept.name: ${CDK_ENV}
    org.name: ${CDK_ORG}

albs:
    - name: ${CDK_PFIX}-${CDK_ENV}-external-ecs-alb
      vpc: ${CDK_PFIX}-${CDK_ENV}-vpc
      ssmKey: /${CDK_PFIX}/${CDK_ENV}/alb/external/dns
      subnetType: public
      securityGroups:
          - /${CDK_PFIX}/${CDK_ENV}/sg/alb-external
      targetGroups:
          - name: ${CDK_PFIX}-${CDK_ENV}-web-tg
            ssmKey: /${CDK_PFIX}/${CDK_ENV}/alb/tg/web
            port: 8590
            healthCheck: /web/v1/public/healthCheck
            intervalInSec: 120
      listeners:
          - name: ${CDK_PFIX}-${CDK_ENV}-http-listner
            protocol: http
            port: 80
            redirect: true
          - name: ${CDK_PFIX}-${CDK_ENV}-https-listner
            protocol: https
            port: 443
            defaultTargetGroup: ${CDK_PFIX}-${CDK_ENV}-web-tg
            certificates:
                - /${CDK_PFIX}/${CDK_ENV}/certs/cert1
            rules:
                - name: sdk
                  path: /sdk/*
                  priority: 1
                  targetGroup: ${CDK_PFIX}-${CDK_ENV}-sdk-tg
                - name: datalistener
                  path: /datalistener/*
                  priority: 2
                  targetGroup: ${CDK_PFIX}-${CDK_ENV}-datalistener-tg
                - name: email
                  path: /email/*
                  priority: 3
                  targetGroup: ${CDK_PFIX}-${CDK_ENV}-emaillistener-tg
                - name: metadata
                  path: /metadata/*
                  priority: 4
                  targetGroup: ${CDK_PFIX}-${CDK_ENV}-metadata-tg
                - name: data
                  path: /data/*
                  priority: 5
                  targetGroup: ${CDK_PFIX}-${CDK_ENV}-data-tg
                - name: identity
                  path: /identity/*
                  priority: 6
                  targetGroup: ${CDK_PFIX}-${CDK_ENV}-identity-tg
                - name: main
                  path: /main/*
                  priority: 7
                  targetGroup: ${CDK_PFIX}-${CDK_ENV}-main-tg
