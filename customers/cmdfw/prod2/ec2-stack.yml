## This stack will create ASG
stackName: ${CDK_PFIX}-${CDK_ENV}-ec2-stack
region: ${CDK_REGION}
accountId: ${CDK_ENV}.accountid
tags:
    cost.center: ${CDK_ENV}
    dept.name: ${CDK_ENV}
    org.name: ${CDK_ORG}

ec2:
    - name: ${CDK_PFIX}-${CDK_ENV}-bastian-ec2
      vpc: ${CDK_PFIX}-${CDK_ENV}-vpc
      subnetType: public
      sg: /${CDK_PFIX}/${CDK_ENV}/sg/bastian
      role: /${CDK_PFIX}/${CDK_ENV}/iam/role/comp
      ami: amzn2-ami-hvm-2.0.20210721.2-x86_64-gp2 # LinuxBastion-08-12-2021
      instanceType: BURSTABLE2
      instanceSize: NANO
      keypair: ${CDK_PFIX}-${CDK_ENV}-ec2key1
      autoScalingEnabled: true
      userData: |
          #!/bin/bash
          sudo su - ec2-user
          cd /home/ec2-user
          mkdir -p .local/bin
          sudo yum install -y ec2-instance-connect
          sudo yum install -y docker
          sudo service docker start
          sudo usermod -a -G docker ec2-user
          sudo yum install -y git
          sudo curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-$(uname -s)-$(uname -m) -o /home/ec2-user/.local/bin/docker-compose
          sudo chmod +x /home/ec2-user/.local/bin/docker-compose
          source .bash_profile
          sudo yum install -y socat
          sudo yum update -y
