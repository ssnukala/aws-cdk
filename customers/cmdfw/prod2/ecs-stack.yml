## This stack will create ECS
stackName: ${CDK_PFIX}-${CDK_ENV}-ecs-stack
region: ${CDK_REGION}
accountId: ${CDK_ENV}.accountid
tags:
    cost.center: ${CDK_ENV}
    dept.name: ${CDK_ENV}
    org.name: ${CDK_ORG}

ecs:
    name: ${CDK_PFIX}-${CDK_ENV}-ecs-cluster
    vpc: ${CDK_PFIX}-${CDK_ENV}-vpc
    services:
        - name: ${CDK_PFIX}-${CDK_ENV}-web-service
          targetGroup: /${CDK_PFIX}/${CDK_ENV}/alb/tg/web
          subnetType: private
          securityGroups:
            - /${CDK_PFIX}/${CDK_ENV}/sg/app
          task:
            name: ${CDK_PFIX}-${CDK_ENV}-web-task
            cpu: 2048
            memory: 4096
            role: arn:aws:iam::${accountId}:role/${CDK_PFIX}-prod2-comp-role
            logGroup: /${CDK_PFIX}-${CDK_ENV}-ecs-web-service
            streamPrefix: ${CDK_PFIX}-${CDK_ENV}-web
            retentionDays: ONE_DAY
            container:
              name: nginx
              ecrRepoName: cmdfw.prod2.uf46msc-nginx
              tag: 1.0.0.1
              containerPort: 80
              hostPort: 80
              entryPoint:
                  - "sh"
                  - "-c"
                  - "java -Djava.security.egd=file:/dev/./urandom -jar /ecs-config.jar --config.sourceUrl=https://gitlab.com/swish/swish-config-dev.git --config.sourceUsername=${CDK_PFIX}-config-reader --config.sourcePassword=sanfrancisc00717 --secret.sourceUrl=s3://${CDK_PFIX}-dev2-apps"
              environment:
            autoScaling:
              memUtilizationPercent: 75
              cpuUtilizationPercent: 75
              minCapacity: 1
              maxCapacity: 3